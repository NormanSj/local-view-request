
<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html;">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
<title>Location Projects</title>

<script type="text/javascript" src="/localsite/js/jquery.min.js" id="/localsite/js/jquery.min.js"></script>
<script type="text/javascript" src="/localsite/js/d3.v5.min.js" id="/localsite/js/d3.v5.min.js"></script>
<script type="text/javascript" src="/localsite/js/localsite.js?showheader=true&showsearch=true"></script>

</head>

<body>

<div class="content contentpadding">
<button onclick="getGeolocation()">
  Get my coordinates!
</button>
<div id="demo"></div>
<br>

<a href="test-cors.html">Display using CORS passthrough</a><br>
<a href="/io/template/feed/">Display using direct API call</a> - To develop using bearer or passthrough<br><br>

<a href="https://www.civicservice.civicplus.help/hc/en-us/articles/360043963693-SeeClickFix-Integration-Polling-Schedule">SeeClickFix Integration Polling Schedule</a>

</div>


<script>
  const demo = document.getElementById('demo');
  function error(err) {
      demo.innerHTML = `Failed to locate. Error: ${err.message}`;
  }

  function success(pos) {
      demo.innerHTML = 'Located.';
      alert(`${pos.coords.latitude}, ${pos.coords.longitude}`);

      // https://seeclickfix.com/open311/v2/docs
      // https://seeclickfix.com/open311/v2/requests.json?lat=41.307153&long=-72.925791
      // https://seeclickfix.com/open311/v2/services.json?lat=41.307153&long=-72.925791
  }

  function getGeolocation() {
      if (navigator.geolocation) {
          demo.innerHTML = 'Locatingâ€¦';
          navigator.geolocation.getCurrentPosition(success, error);
      } else { 
          demo.innerHTML = 'Geolocation is not supported by this browser.';
      }
  }
</script>
   





<script>
/*
var options = {
  enableHighAccuracy: true,
  timeout: 5000,
  maximumAge: 0
};

function success(pos) {
  var crd = pos.coords;

  console.log('Your current position is:');
  console.log(`Latitude : ${crd.latitude}`);
  console.log(`Longitude: ${crd.longitude}`);
  console.log(`More or less ${crd.accuracy} meters.`);
}

function error(err) {
  console.warn(`ERROR(${err.code}): ${err.message}`);
}

navigator.geolocation.getCurrentPosition(success, error, options);




//https://stackoverflow.com/questions/10077606/check-if-geolocation-was-allowed-and-get-lat-lon
function getCoords() {
  return new Promise((resolve, reject) =>
    navigator.permissions ?

      // Permission API is implemented
      navigator.permissions.query({
        name: 'geolocation'
      }).then(permission =>
        // is geolocation granted?
        permission.state === "granted"
          ? navigator.geolocation.getCurrentPosition(pos => resolve(pos.coords)) 
          : resolve(null)
      ) :

    // Permission API was not implemented
    reject(new Error("Permission API is not supported"))
  )
}

getCoords().then(coords => alert(coords))
*/
</script>


<div id="requests"></div>

<script>
function displayRequests(latitude, longitude) {
    const url = `https://seeclickfix.com/open311/v2/requests.json?lat=${latitude}&long=${longitude}`;
    
    d3.json(url)
        .then(data => {
            const requestsDiv = document.getElementById('requests');
            
            data.forEach(item => {
                const requestDiv = document.createElement('div');
                requestDiv.innerHTML = `
                    <p>Description: ${item.description}</p>
                    <p>Address: ${item.address}</p>
                    <p>Latitude: ${item.lat}</p>
                    <p>Longitude: ${item.long}</p>
                    <p>Service Request ID: ${item.service_request_id}</p>
                    <p>Requested Datetime: ${item.requested_datetime}</p>
                    <p>Service Code: ${item.service_code}</p>
                    <p>Status: ${item.status}</p>
                    <p>Zipcode: ${item.zipcode}</p>
                    <p>Updated Datetime: ${item.updated_datetime}</p>
                    <p>Agency Responsible: ${item.agency_responsible}</p>
                    <p>Service Name: ${item.service_name}</p>
                    <p>Media URL: ${item.media_url}</p>
                    <p>Expected Datetime: ${item.expected_datetime}</p>
                    <p>Address ID: ${item.address_id}</p>
                    <p>Service Notice: ${item.service_notice}</p>
                    <p>Status Notes: ${item.status_notes}</p>
                    <hr>
                `;
                requestsDiv.appendChild(requestDiv);
            });
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });
}

// Example usage:
const latitude = 41.307153;
const longitude = -72.925791;
displayRequests(latitude, longitude);
</script>

</body>
</html>